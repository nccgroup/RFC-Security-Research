#!/usr/bin/python3

# Matt Lewis, NCC Group 2020
#
# script runs through all NIST json files of vulns and extracts just the CVE, CWE
# and description of each entry - use with grep to get entries  of interest. E.g.
#
# >python vulnparse.py | grep 'Internet Printing Protocol' 
#
# download and extract all relevant NIST json files from here:
#
# https://nvd.nist.gov/vuln/data-feeds

from os import listdir
import json

folder = '.'
files = (f for f in listdir(folder) if f.endswith('.json'))

for f in files:
    file1 = open(f, 'r') 
    Lines = file1.readlines() 
      
    getDesc = False

    for line in Lines:
        if '\"ID\" : \"CVE' in line:
            cve = line.replace('ID','').replace('\"','').replace(' ','').replace(':','').replace(',','').strip()

        if '\"value\" : \"CWE' in line:
            cwe = line.replace('value','').replace('\"','').replace(' ','').replace(':','').replace(',','').strip()

        if '\"description_data\" :' in line:
            getDesc = True

        if getDesc and '\"value\" :' in line:
            desc = line.replace('\"value\" : ','').replace('          \"','').strip()[:-1]
            print(cve + ',' + cwe + ',' + desc)
            getDesc = False


        
        

